{% load static %}
<div class="product-card">
    <style>
        .product-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .product-card:hover {
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
            border-color: #d1d1d1;
        }
        .product-media {
            position: relative;
            background: #fff;
            width: 100%;
            padding-top: 100%; /* Aspect Ratio 1:1 trick */
            overflow: hidden;
        }
        .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px; /* Minimal padding for breathing room */
        }
        .product-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.4s ease;
        }
        .product-card:hover .product-image img {
            transform: scale(1.08);
        }
        .product-badges {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 1; /* Reduced from 10 to prevents overlap with header */
            pointer-events: none;
            direction: ltr; /* Force LTR specifically for badge alignment */
        }
        .badge-item {
            padding: 4px 10px;
            border-radius: 4px;
            color: #fff;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .badge-flag { background: #3866df; } /* Blue for New */
        .badge-discount { background: #dc3545; } /* Red for Discount */

        .product-content {
            padding: 12px 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            text-align: right;
        }
        .product-name a {
            color: #333;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            display: block;
            height: 40px; /* Fixed height for 2 lines */
            overflow: hidden;
            text-decoration: none;
        }
        .product-price {
            margin-top: 8px;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        .new-price {
            color: #28a745; /* Green */
            font-size: 18px;
            font-weight: bold;
        }
        .old-price {
            color: #dc3545; /* Red */
            font-size: 13px;
            text-decoration: line-through;
            opacity: 0.8;
        }
        .currency {
            font-size: 12px;
            color: #28a745;
            font-weight: normal;
        }
        .product-add {
            margin-top: 12px;
            width: 100%;
            padding: 10px;
            border: 1px solid #3866df;
            background: #fff;
            color: #3866df;
            border-radius: 6px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .product-add:hover {
            background: #3866df;
            color: #fff;
        }
    </style>
    <div class="product-media">
        <div class="product-badges">
            {% if product.flag %}
            <span class="badge-item badge-flag">{{ product.flag }}</span>
            {% else %}
            <span></span> <!-- Spacer if needed, or flex handles it -->
            {% endif %}

            {% if product.discount_percentage > 0 %}
            <span class="badge-item badge-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
        </div>

        <a class="product-image" href="{% url 'product_detail' product.slug %}">
            <img src="{{ product.image.url }}" alt="product" />
        </a>
        <div class="product-widget">
            <a title="Product View" href="#" class="fas fa-eye" data-bs-toggle="modal"
                data-bs-target="#product-view"
                data-id="{{ product.id }}"
                data-name="{{ product.name }}"
                data-price="{{ product.new_price }}"
                data-old-price="{{ product.old_price }}"
                data-image="{{ product.image.url }}"
                data-desc="{{ product.description|default:'وصف المنتج غير متوفر حالياً' }}"
                data-sku="{{ product.sku|default:'-' }}"
                data-brand="{{ product.brand.name|default:'-' }}"
                data-flag="{{ product.flag|default:'' }}"
                data-discount="{{ product.discount_percentage|default:0 }}"
            ></a>
        </div>
    </div>
    <div class="product-content">
        <h6 class="product-name">
            <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
        </h6>
        <div class="product-price">
            {% if product.new_price > 0 %}
                <span class="new-price">{{ product.new_price }} <span class="currency">ر.س</span></span>
                {% if product.old_price > product.new_price %}
                    <span class="old-price">{{ product.old_price }}</span>
                {% endif %}
            {% else %}
                <span class="new-price">{{ product.old_price }} <span class="currency">ر.س</span></span>
            {% endif %}
        </div>
        <button class="product-add" title="أضف إلى السلة" data-id="{{ product.id }}">
            <i class="fas fa-shopping-basket"></i>
            <span>أضف إلى السلة</span>
        </button>
        <div class="product-action">
            <button class="action-minus" title="Quantity Minus">
                <i class="icofont-minus"></i>
            </button>
            <input class="action-input" title="Quantity Number" type="text" name="quantity" value="1" />
            <button class="action-plus" title="Quantity Plus">
                <i class="icofont-plus"></i>
            </button>
        </div>
    </div>
</div>